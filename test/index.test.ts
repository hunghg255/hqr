import { describe, expect, it } from 'vitest'
import { renderUnicode, renderUnicodeCompact } from '../src/render'
import { encode, renderSVG } from '../src'
import { renderBase64 } from '../src/base64'

describe('should', () => {
  it('generate', () => {
    const { data, types } = encode('qrcode', {
      minVersion: 2,
    })

    expect(data.map(i => i.map(j => j ? 1 : ' ').join(' ')))
      .toMatchInlineSnapshot(`
        [
          "                                                     ",
          "  1 1 1 1 1 1 1     1           1 1   1 1 1 1 1 1 1  ",
          "  1           1   1 1   1 1           1           1  ",
          "  1   1 1 1   1     1 1 1     1   1   1   1 1 1   1  ",
          "  1   1 1 1   1   1 1   1         1   1   1 1 1   1  ",
          "  1   1 1 1   1       1   1 1 1 1     1   1 1 1   1  ",
          "  1           1   1   1     1 1 1 1   1           1  ",
          "  1 1 1 1 1 1 1   1   1   1   1   1   1 1 1 1 1 1 1  ",
          "                          1 1   1                    ",
          "  1 1 1 1 1   1 1 1 1 1   1   1 1   1   1   1   1    ",
          "  1   1   1 1       1           1 1   1 1 1 1        ",
          "    1     1 1 1     1   1 1           1   1   1 1 1  ",
          "            1   1   1 1 1     1   1 1 1 1 1          ",
          "    1   1     1   1 1   1         1   1 1   1 1   1  ",
          "  1       1 1     1   1   1 1 1 1   1 1       1 1    ",
          "  1   1 1 1   1   1 1 1     1 1 1 1 1   1     1 1 1  ",
          "  1   1     1     1       1 1   1               1 1  ",
          "  1   1 1     1 1 1 1     1   1 1 1 1 1 1 1 1 1   1  ",
          "                  1 1 1         1 1       1     1    ",
          "  1 1 1 1 1 1 1   1   1 1 1     1 1   1   1 1   1 1  ",
          "  1           1     1 1 1     1   1       1          ",
          "  1   1 1 1   1   1     1         1 1 1 1 1 1 1 1 1  ",
          "  1   1 1 1   1   1       1 1 1 1 1 1             1  ",
          "  1   1 1 1   1   1   1     1 1   1   1 1 1       1  ",
          "  1           1   1 1     1 1         1   1 1     1  ",
          "  1 1 1 1 1 1 1   1   1   1   1 1   1 1 1 1 1   1 1  ",
          "                                                     ",
        ]
      `)

    expect(types.map(i => i.map(j => j < 1 ? ' ' : j).join(' ')))
      .toMatchInlineSnapshot(`
        [
          "                                                     ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2  ",
          "  2 2 2 2 2 2 2 2 1                 2 2 2 2 2 2 2 2  ",
          "  1 1 1 1 1 1 3 1 1                 1 1 1 1 1 1 1 1  ",
          "              3                                      ",
          "              3                                      ",
          "              3                                      ",
          "              3                                      ",
          "              3                                      ",
          "              3                                      ",
          "              3                                      ",
          "              3                   4 4 4 4 4          ",
          "  2 2 2 2 2 2 2 2 1               4 4 4 4 4          ",
          "  2 2 2 2 2 2 2 2 1               4 4 4 4 4          ",
          "  2 2 2 2 2 2 2 2 1               4 4 4 4 4          ",
          "  2 2 2 2 2 2 2 2 1               4 4 4 4 4          ",
          "  2 2 2 2 2 2 2 2 1                                  ",
          "  2 2 2 2 2 2 2 2 1                                  ",
          "  2 2 2 2 2 2 2 2 1                                  ",
          "  2 2 2 2 2 2 2 2 1                                  ",
          "                                                     ",
        ]
      `)
  })

  it('render-unicode', () => {
    expect(`\n${renderUnicode('qrcode', {
      whiteChar: '██',
      blackChar: '░░',
    })}`)
      .toMatchInlineSnapshot(`
        "
        ██████████████████████████████████████████████
        ██░░░░░░░░░░░░░░██░░░░████░░██░░░░░░░░░░░░░░██
        ██░░██████████░░████░░████░░██░░██████████░░██
        ██░░██░░░░░░██░░██░░██░░██░░██░░██░░░░░░██░░██
        ██░░██░░░░░░██░░██░░████░░████░░██░░░░░░██░░██
        ██░░██░░░░░░██░░██░░░░░░██████░░██░░░░░░██░░██
        ██░░██████████░░██████████████░░██████████░░██
        ██░░░░░░░░░░░░░░██░░██░░██░░██░░░░░░░░░░░░░░██
        ████████████████████░░░░██████████████████████
        ██░░░░░░░░████░░██░░██░░████░░████░░░░░░██░░██
        ██████░░██░░████░░░░░░████░░████░░████░░░░░░██
        ██░░██░░░░████░░░░████████░░░░░░░░░░░░░░░░░░██
        ██░░░░██░░░░░░████████░░██░░░░██████░░████████
        ████░░██████░░░░██░░░░██░░██░░████░░██████████
        ██████████████████░░██░░████░░██████░░██░░████
        ██░░░░░░░░░░░░░░████████████░░░░██░░░░░░██████
        ██░░██████████░░██████░░░░░░░░░░████░░░░██░░██
        ██░░██░░░░░░██░░████░░██░░████░░░░██░░░░░░░░██
        ██░░██░░░░░░██░░██░░░░░░████░░██████░░░░░░████
        ██░░██░░░░░░██░░██░░██░░░░██░░██████░░████████
        ██░░██████████░░██░░░░██░░░░██░░██████████░░██
        ██░░░░░░░░░░░░░░██░░░░░░░░░░████░░░░██░░██████
        ██████████████████████████████████████████████"
      `)
  })

  it('render-unicode-compact', () => {
    const code = renderUnicodeCompact('qrcode', { invert: false })
    // console.log(code)
    expect(`\n${code}`)
      .toMatchInlineSnapshot(`
        "
        █▀▀▀▀▀▀▀█▀▀██▀█▀▀▀▀▀▀▀█
        █ █▀▀▀█ █▀▄▀█ █ █▀▀▀█ █
        █ █   █ █ ▀▀▄██ █   █ █
        █ ▀▀▀▀▀ █▀█▀█▀█ ▀▀▀▀▀ █
        █▀▀▀▀██▀█▀▄ ██▀██▀▀▀█▀█
        █▀█ ▀▄█▀ ▄▄██ ▀▀ ▀▀   █
        █▄ █▄▄ ▀█▀▀▄▀▄ ██▀▄████
        █▀▀▀▀▀▀▀█▄█▄██ ▀█▀ ▀▄██
        █ █▀▀▀█ ██▀▄ ▄▄ ▀█  ▀ █
        █ █   █ █ ▄ ▀█ ███ ▄▄██
        █ ▀▀▀▀▀ █  ▀  █▄▀▀█▀█▄█
        ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀"
      `)
  })

  // it('render-ansi', () => {
  //   console.log(renderANSI('qrcode'))
  // })

  it('render-svg', () => {
    const svg = renderSVG('qrcode')
    // console.log(svg)

    expect(svg).toMatchFileSnapshot('./output/out1.svg')
  })
  it('render-base64', () => {
    const base64 = renderBase64('qrcode', {
      pixelSize: 5,
    })

    // expect(svg).toMatchFileSnapshot('./output/out1.svg')
  })
})
